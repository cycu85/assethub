# PLAN IMPLEMENTACJI MODUÅU "ASEKURACJA"

## WYMAGANIA FUNKCJONALNE

### GÅ‚Ã³wne funkcjonalnoÅ›ci:
1. Lista sprzÄ™tu âœ…
2. Dane zakupowe dla sprzÄ™tu âœ…
3. MoÅ¼liwoÅ›Ä‡ tworzenia zestawÃ³w âœ…
4. Dodawanie elementÃ³w do zestawu jako popup/modal z listÄ… dostÄ™pnych elementÃ³w (z moÅ¼liwoÅ›ciÄ… filtrowania i wyszukiwania) i moÅ¼liwoÅ›Ä‡ wybrania wielu zaznaczajÄ…c Checkbox
5. MoÅ¼liwoÅ›Ä‡ tworzenia przeglÄ…dÃ³w (workflow Przygotowanie do przeglÄ…du > wysÅ‚anie na przeglÄ…d -> powrÃ³t z przeglÄ…du) âœ…
6. PrzeglÄ…dy zarÃ³wno dla pojedynczych elementÃ³w jak i dla zestawÃ³w âœ…
7. PrzeglÄ…dy dla wybranych elementÃ³w zestawu âœ…
8. Przekazanie do pracownikÃ³w (workflow Generowanie przekazania -> dodanie skanu przekazania i zakoÅ„czenie flow) âœ…
9. Generowanie protokoÅ‚u przekazania w formacie pdf
10. SÅ‚owniki w /admin/dictionaries/
11. MoÅ¼liwoÅ›Ä‡ zaÅ‚Ä…czanie i wyÅ‚Ä…czania moduÅ‚u âœ…
12. Role âœ…:
    a. System_admin - widzi wszystko âœ…
    b. Assek_admin - peÅ‚ne prawa do moduÅ‚u âœ…
    c. Assek_editor - nie moÅ¼e usuwaÄ‡ âœ…
    d. Assek_viewer - tylko podglÄ…d âœ…
    e. Assek_list - tylko lista zestawÃ³w i elementÃ³w âœ…
    f. Pracownik do ktÃ³rego przypisany jest sprzÄ™t/zestaw widzi tylko swoje zestawy/sprzety bez edcji âœ…
13. Powiadomienia email o zbliÅ¼ajÄ…cych siÄ™ terminach przeglÄ…du dla pracownika, Assek_admin, Assek_editor
14. Powiadomienia w dzwoneczku o przeglÄ…dach dla pracownika, Assek_admin, Assek_editor
15. Raport zbiorczy email o zbliÅ¼ajÄ…cych siÄ™ przeglÄ…dach dla Assek_admin, Assek_editor

## ARCHITEKTURA ENTERPRISE âœ…

### Wzorce zaimplementowane:
- âœ… Service Layer Pattern - separacja logiki biznesowej
- âœ… CQRS - komendy i zapytania
- âœ… Event-Driven Architecture - zdarzenia domenowe
- âœ… AuthorizationService - centralna autoryzacja
- âœ… AuditService - kompleksowy audit trail

### Struktura folderÃ³w âœ…:
```
src/AsekuracyjnySPM/
â”œâ”€â”€ Entity/ âœ…
â”‚   â”œâ”€â”€ AsekuracyjnyEquipment.php âœ…
â”‚   â”œâ”€â”€ AsekuracyjnyEquipmentSet.php âœ…
â”‚   â”œâ”€â”€ AsekuracyjnyReview.php âœ…
â”‚   â”œâ”€â”€ AsekuracyjnyTransfer.php âœ…
â”‚   â””â”€â”€ AsekuracyjnyNotification.php
â”œâ”€â”€ Service/ âœ…
â”‚   â”œâ”€â”€ AsekuracyjnyService.php âœ…
â”‚   â”œâ”€â”€ ReviewService.php
â”‚   â”œâ”€â”€ TransferService.php
â”‚   â””â”€â”€ NotificationService.php
â”œâ”€â”€ Controller/
â”‚   â”œâ”€â”€ AsekuracyjnyController.php
â”‚   â”œâ”€â”€ EquipmentSetController.php
â”‚   â”œâ”€â”€ ReviewController.php
â”‚   â””â”€â”€ TransferController.php
â”œâ”€â”€ Repository/ âœ…
â”‚   â”œâ”€â”€ AsekuracyjnyEquipmentRepository.php âœ…
â”‚   â”œâ”€â”€ AsekuracyjnyEquipmentSetRepository.php âœ…
â”‚   â”œâ”€â”€ AsekuracyjnyReviewRepository.php âœ…
â”‚   â””â”€â”€ AsekuracyjnyTransferRepository.php âœ…
â”œâ”€â”€ Form/
â”œâ”€â”€ Command/
â”œâ”€â”€ Query/
â”œâ”€â”€ Event/
â””â”€â”€ EventSubscriber/
```

## SCHEMA BAZY DANYCH âœ…

### Encje gÅ‚Ã³wne âœ…:
1. **AsekuracyjnyEquipment** - sprzÄ™t asekuracyjny âœ…
2. **AsekuracyjnyEquipmentSet** - zestawy sprzÄ™tu âœ…
3. **AsekuracyjnyReview** - przeglÄ…dy âœ…
4. **AsekuracyjnyTransfer** - przekazania âœ…
5. **AsekuracyjnyNotification** - powiadomienia

### Relacje âœ…:
- Equipment N:M EquipmentSet (przez tabelÄ™ AsekuracyjnyEquipmentSetItem) âœ…
- Equipment 1:N Review âœ…
- EquipmentSet 1:N Review âœ…
- Equipment 1:N Transfer âœ…
- EquipmentSet 1:N Transfer âœ…
- User 1:N Equipment (assigned_to) âœ…
- User 1:N EquipmentSet (assigned_to) âœ…

## ROLE I UPRAWNIENIA âœ…

### ModuÅ‚ zarejestrowany âœ…:
```sql
INSERT INTO modules (name, display_name, description, is_enabled, created_at, updated_at) 
VALUES ('asekuracja', 'Asekuracja', 'ZarzÄ…dzanie sprzÄ™tem asekuracyjnym/wysokoÅ›ciowym', 1, NOW(), NOW());
```

### Role utworzone âœ…:
```sql
INSERT INTO roles (name, description, permissions, module_id, is_system_role, created_at, updated_at) VALUES
('ASSEK_ADMIN', 'Administrator Asekuracji - peÅ‚ne prawa do moduÅ‚u', '["VIEW","CREATE","EDIT","DELETE","ASSIGN","REVIEW","TRANSFER"]', 3, 0, NOW(), NOW()),
('ASSEK_EDITOR', 'Edytor Asekuracji - bez uprawnieÅ„ do usuwania', '["VIEW","CREATE","EDIT","ASSIGN","REVIEW","TRANSFER"]', 3, 0, NOW(), NOW()),
('ASSEK_VIEWER', 'PrzeglÄ…dajÄ…cy Asekuracji - tylko podglÄ…d', '["VIEW"]', 3, 0, NOW(), NOW()),
('ASSEK_LIST', 'Lista Asekuracji - tylko lista zestawÃ³w i elementÃ³w', '["VIEW_LIST"]', 3, 0, NOW(), NOW());
```

## FUNKCJONALNOÅšCI GÅÃ“WNE

### 1. ZarzÄ…dzanie sprzÄ™tem âœ…
- âœ… Lista z filtrowaniem i wyszukiwaniem (repository)
- âœ… CRUD z danymi zakupowymi (service)
- âœ… Status (dostÄ™pny, przypisany, na przeglÄ…dzie, uszkodzony)
- âœ… Przypisywanie/cofanie przypisaÅ„ (service)

### 2. Zestawy sprzÄ™tu âœ…
- âœ… Tworzenie zestawÃ³w tematycznych (entity + service)
- Modal z wyborem sprzÄ™tu (multi-select) - TODO: kontroler + template
- âœ… ZarzÄ…dzanie skÅ‚adnikami zestawu (service)

### 3. System przeglÄ…dÃ³w âœ…
- âœ… Workflow: Przygotowanie â†’ WysÅ‚anie â†’ PowrÃ³t (entity)
- âœ… PrzeglÄ…dy pojedynczych elementÃ³w i zestawÃ³w (entity)
- âœ… Wybrane elementy z zestawu (selectedEquipmentIds)
- âœ… Terminy nastÄ™pnych przeglÄ…dÃ³w (entity)

### 4. Przekazania pracownikom âœ…
- âœ… Workflow: Generowanie â†’ Skan â†’ ZakoÅ„czenie (entity)
- ProtokoÅ‚y PDF - TODO: service
- âœ… Historia przekazaÅ„ (repository)

### 5. Powiadomienia
- Email o zbliÅ¼ajÄ…cych siÄ™ przeglÄ…dach - TODO: service
- Powiadomienia w aplikacji (dzwoneczek) - TODO: service
- Raporty zbiorcze dla adminÃ³w - TODO: service

## SÅOWNIKI

### Do utworzenia:
```sql
-- Typy sprzÄ™tu
INSERT INTO dictionaries (type, name, value, description, is_active, is_system, sort_order, created_at, updated_at) VALUES 
('assek_equipment_types', 'Szelki', 'harness', 'Szelki asekuracyjne', 1, 1, 1, NOW(), NOW()),
('assek_equipment_types', 'Liny', 'rope', 'Liny asekuracyjne', 1, 1, 2, NOW(), NOW()),
('assek_equipment_types', 'Kaski', 'helmet', 'Kaski ochronne', 1, 1, 3, NOW(), NOW()),
('assek_equipment_types', 'Zacisk', 'ascender', 'Zaciski i Å¼umar', 1, 1, 4, NOW(), NOW());

-- Statusy przeglÄ…du
INSERT INTO dictionaries (type, name, value, description, is_active, is_system, sort_order, created_at, updated_at) VALUES 
('assek_review_status', 'Przygotowanie', 'preparation', 'Przygotowanie do przeglÄ…du', 1, 1, 1, NOW(), NOW()),
('assek_review_status', 'Na przeglÄ…dzie', 'in_review', 'WysÅ‚ane na przeglÄ…d', 1, 1, 2, NOW(), NOW()),
('assek_review_status', 'ZakoÅ„czone', 'completed', 'PrzeglÄ…d zakoÅ„czony', 1, 1, 3, NOW(), NOW());

-- Typy zestawÃ³w
INSERT INTO dictionaries (type, name, value, description, is_active, is_system, sort_order, created_at, updated_at) VALUES 
('assek_set_types', 'Podstawowy', 'basic', 'Podstawowy zestaw asekuracyjny', 1, 1, 1, NOW(), NOW()),
('assek_set_types', 'Zaawansowany', 'advanced', 'Zaawansowany zestaw asekuracyjny', 1, 1, 2, NOW(), NOW()),
('assek_set_types', 'Specjalistyczny', 'specialist', 'Specjalistyczny zestaw asekuracyjny', 1, 1, 3, NOW(), NOW());
```

## CHECKLIST IMPLEMENTACJI

### âœ… ZAIMPLEMENTOWANE:
- [âœ…] **Analiza wymagaÅ„ i plan architektoniczny**
- [âœ…] **Projekt schematu bazy danych z encjami i relacjami**
- [âœ…] **Rejestracja moduÅ‚u w systemie (modules, roles)**
- [âœ…] **Utworzenie encji gÅ‚Ã³wnych (Equipment, EquipmentSet, Review, Transfer)**
- [âœ…] **Implementacja repozytoriÃ³w dla wszystkich encji**
- [âœ…] **AsekuracyjnyService - gÅ‚Ã³wna logika biznesowa**

### ğŸ”„ DO ZAIMPLEMENTOWANIA:

#### Serwisy biznesowe:
- [ ] **ReviewService** - zarzÄ…dzanie przeglÄ…dami z workflow
- [ ] **TransferService** - przekazania pracownikom z generowaniem PDF
- [ ] **NotificationService** - powiadomienia email i w aplikacji

#### Kontrolery z autoryzacjÄ…:
- [ ] **AsekuracyjnyController** - gÅ‚Ã³wny kontroler sprzÄ™tu
- [ ] **EquipmentSetController** - zarzÄ…dzanie zestawami
- [ ] **ReviewController** - system przeglÄ…dÃ³w
- [ ] **TransferController** - przekazania pracownikom

#### Formularze Symfony:
- [ ] **AsekuracyjnyEquipmentType** - formularz sprzÄ™tu
- [ ] **AsekuracyjnyEquipmentSetType** - formularz zestawu
- [ ] **AsekuracyjnyReviewType** - formularz przeglÄ…du
- [ ] **AsekuracyjnyTransferType** - formularz przekazania
- [ ] **EquipmentSelectionType** - wybÃ³r sprzÄ™tu do zestawu (modal)

#### Szablony Twig z Bootstrap:
- [ ] **equipment/index.html.twig** - lista sprzÄ™tu
- [ ] **equipment/show.html.twig** - szczegÃ³Å‚y sprzÄ™tu
- [ ] **equipment/form.html.twig** - formularz sprzÄ™tu
- [ ] **equipment-set/index.html.twig** - lista zestawÃ³w
- [ ] **equipment-set/show.html.twig** - szczegÃ³Å‚y zestawu + modal wyboru
- [ ] **review/index.html.twig** - lista przeglÄ…dÃ³w
- [ ] **transfer/index.html.twig** - lista przekazaÅ„

#### System generowania PDF:
- [ ] **ProtokÃ³Å‚ przekazania** - generowanie PDF z TCPDF/mPDF
- [ ] **Szablon protokoÅ‚u** - profesjonalny layout z logo

#### Powiadomienia:
- [ ] **EmailNotificationService** - powiadomienia email
- [ ] **InAppNotificationService** - powiadomienia w dzwoneczku
- [ ] **ReportService** - raporty zbiorcze email

#### SÅ‚owniki w panelu admin:
- [ ] **Dodanie typÃ³w sprzÄ™tu do sÅ‚ownikÃ³w**
- [ ] **Dodanie statusÃ³w przeglÄ…du do sÅ‚ownikÃ³w**
- [ ] **Dodanie typÃ³w zestawÃ³w do sÅ‚ownikÃ³w**

#### Dane przykÅ‚adowe:
- [ ] **AsekuracyjnyFixtures** - dane testowe dla instalatora
- [ ] **PrzykÅ‚adowy sprzÄ™t i zestawy**
- [ ] **PrzykÅ‚adowe przeglÄ…dy i przekazania**

#### Testy jednostkowe:
- [ ] **AsekuracyjnyServiceTest** - test serwisu gÅ‚Ã³wnego
- [ ] **ReviewServiceTest** - test serwisu przeglÄ…dÃ³w
- [ ] **TransferServiceTest** - test serwisu przekazaÅ„
- [ ] **AsekuracyjnyControllerTest** - test kontrolera
- [ ] **Repository tests** - testy repozytoriÃ³w

#### Menu i routing:
- [ ] **Dodanie moduÅ‚u do menu bocznego** (templates/partials/sidebar.html.twig)
- [ ] **Konfiguracja route'Ã³w** - wszystkie Å›cieÅ¼ki moduÅ‚u
- [ ] **Breadcrumbs** - nawigacja w szablonach

#### Dokumentacja:
- [ ] **README moduÅ‚u** - instrukcja instalacji i konfiguracji
- [ ] **Dokumentacja API** - opis endpointÃ³w
- [ ] **Instrukcja uÅ¼ytkownika** - jak korzystaÄ‡ z moduÅ‚u

## WZORCE I KONWENCJE

### ZgodnoÅ›Ä‡ z kontekstem aplikacji âœ…:
- âœ… **Service Layer Pattern** - wszystkie operacje przez serwisy
- âœ… **AuthorizationService** - sprawdzanie uprawnieÅ„ w kontrolerach
- âœ… **AuditService** - logowanie wszystkich dziaÅ‚aÅ„
- âœ… **Repository Pattern** - zaawansowane zapytania w repozytoriach
- âœ… **Entity Lifecycle** - automatyczne timestampy
- âœ… **Validation** - Symfony validators w encjach

### Konwencje nazewnictwa âœ…:
- âœ… **Kontrolery**: `AsekuracyjnyController`, `ReviewController`
- âœ… **Encje**: `AsekuracyjnyEquipment`, `AsekuracyjnyReview`
- âœ… **Repozytoria**: `AsekuracyjnyEquipmentRepository`
- âœ… **Serwisy**: `AsekuracyjnyService`, `ReviewService`
- âœ… **Szablony**: `asekuracja/{action}.html.twig`

## PRIORYTET IMPLEMENTACJI

### Faza 1 - Podstawowa funkcjonalnoÅ›Ä‡:
1. **ReviewService** i **TransferService**
2. **Kontrolery gÅ‚Ã³wne** z autoryzacjÄ…
3. **Podstawowe formularze** i szablony
4. **Menu i routing**

### Faza 2 - Zaawansowane funkcje:
1. **Modal wyboru sprzÄ™tu** do zestawÃ³w
2. **Generowanie PDF** protokoÅ‚Ã³w
3. **System powiadomieÅ„**
4. **SÅ‚owniki** w panelu admin

### Faza 3 - Finalizacja:
1. **Testy jednostkowe**
2. **Dane przykÅ‚adowe**
3. **Dokumentacja**
4. **Optymalizacja** i poprawki

## STATUS: FUNDAMENT ENTERPRISE GOTOWY âœ…

ModuÅ‚ ma solidne fundamenty zgodne z wzorcami enterprise z kontekstu aplikacji.
Wszystkie encje, repozytoria i gÅ‚Ã³wny serwis biznesowy sÄ… gotowe.
System rÃ³l i uprawnieÅ„ skonfigurowany.
Gotowy do implementacji warstwy prezentacji i pozostaÅ‚ych serwisÃ³w.